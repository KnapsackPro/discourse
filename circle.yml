machine:
  services:
    - redis
  environment:
    DISCOURSE_HOSTNAME: www.example.com
    RUBY_GC_MALLOC_LIMIT: 50000000
  ruby:
    version: 2.3.0

dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install gifsicle jpegoptim optipng jhead

test:
  pre:
    - git clone --depth=1 https://github.com/discourse/discourse-backup-uploads-to-s3.git plugins/discourse-backup-uploads-to-s3
    - git clone --depth=1 https://github.com/discourse/discourse-spoiler-alert.git plugins/discourse-spoiler-alert
    - git clone --depth=1 https://github.com/discourse/discourse-cakeday.git plugins/discourse-cakeday
    - git clone --depth=1 https://github.com/discourse/discourse-canned-replies.git plugins/discourse-canned-replies
    #- npm i -g eslint babel-eslint
    #- eslint app/assets/javascripts
    #- eslint --ext .es6 app/assets/javascripts
    #- eslint --ext .es6 test/javascripts
    #- eslint --ext .es6 plugins/**/assets/javascripts
    #- eslint test/javascripts

  override:
    # don't test plugins installed in ./plugins/
    #- bundle exec rake plugin:spec

    #- bundle exec rake qunit:test['200000']

    #- bundle exec rspec

    - bundle exec rake knapsack_pro:rspec:
        parallel: true # Caution: there are 8 spaces indentation!

    - bundle exec rake knapsack_pro:queue:rspec:
        parallel: true # Caution: there are 8 spaces indentation!
